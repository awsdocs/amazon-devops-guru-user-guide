# Update DevOps Guru settings<a name="update-settings"></a>

 You can update the following Amazon DevOps Guru settings\. 
+ Your DevOps Guru coverage\. This determines which resources in your account are analyzed\. 
+ Your notifications\. This determines which Amazon Simple Notification Service topics are used to notify you of important DevOps Guru events\. 
+ Your AWS Systems Manager integration\. This determines whether an OpsItem is created in Systems Manager OpsCenter for each new insight\. 

**Topics**
+ [Update your management account settings](#update-management-account)
+ [Update your AWS analysis coverage in DevOps Guru](#update-coverage)
+ [Update your notifications in DevOps Guru](#update-notifications)
+ [Filter your DevOps Guru notifications](#update-notifications-filter)
+ [Update AWS Systems Manager integration in DevOps Guru](#update-systems-manager-integration)

## Update your management account settings<a name="update-management-account"></a>

You can configure DevOps Guru for accounts in your organization\. If you haven't registered a delegated administrator, you can do so by choosing **Register delegated administrator**\. For more information on registering a delegated administrator, see [Enable DevOps Guru](https://docs.aws.amazon.com/devops-guru/latest/userguide/getting-started-enable-service.html)\.

## Update your AWS analysis coverage in DevOps Guru<a name="update-coverage"></a>

 You can update which AWS resources in your account DevOps Guru analyzes\. The resources that are analyzed make up your DevOps Guru coverage boundary\. When you specify your boundary, your resources are grouped in applications\. You have four boundary coverage options\. 
+ Choose to have DevOps Guru analyze all supported resources in your account\. All resources in your account that are in a stack are grouped into an application\. If you have multiple stacks in your account, then the resources in each stack make up their own application\. If any resources in your account are not in a stack, they are grouped into their own application\. 
+ Specify resources by choosing AWS CloudFormation stacks that define those resources\. If you do this, DevOps Guru analyzes every resource specified in the stacks you choose\. If a resource in your account is not defined by a stack you choose, it is not analyzed\. 
+ Specify resources by using AWS tags\. DevOps Guru analyzes all the resources in your account and Region that contain the tags you choose\.
+ Specify to have no resources analyzed so that you stop incurring charges from resource analyzation\.
**Note**  
If you update your coverage to stop analyzing resources, you might continue to incur minor charges if you review existing insights generated by DevOps Guru in the past\. These charges are associated with API calls used to retrieve and display insight information\. For more information, see [Amazon DevOps Guru pricing](http://aws.amazon.com/devops-guru/pricing/)\.

 DevOps Guru supports all resources that are associated with supported services\. For more information about the supported services and resources, see [Amazon DevOps Guru pricing](http://aws.amazon.com/devops-guru/pricing/)\. 

**To manage your DevOps Guru analysis coverage**

1. Open the Amazon DevOps Guru console at [https://console\.aws\.amazon\.com/devops\-guru/](https://console.aws.amazon.com/devops-guru/)\.

1. Expand **Settings** in the navigation pane\. 

1. Choose **Analyzed resources**, then choose **Edit**\.

1. Choose one of the following coverage options\. 
   + Choose **All account resources** if you want DevOps Guru to analyze all supported resources in your AWS account and Region\. If you choose this option, your AWS account is your resource analysis coverage boundary\. All resources in each stack in your account are grouped into their own application\. Any remaining resources that are not in a stack are grouped into their own application\.
   + Choose **CloudFormation stacks** if you want DevOps Guru to analyze the resources that are in stacks you choose, then choose one of the following options\.
     + **All resources** – All resources that are in stacks in your account are analyzed\. Resources in each stack are grouped into their own application\. Any resources in your account that are not in a stack are not analyzed\.
     + **Select stacks** – Select the stacks that you want DevOps Guru to analyze\. The resources in each stack you select are grouped into their own application\. You can enter the name of a stack in **Find stacks** to quickly locate a specific stack\. You can select up to 1,000 stacks\.

     For more information, see [Use AWS CloudFormation stacks to identify resources in your DevOps Guru applications](working-with-cfn-stacks.md)\.
   + Choose **Tags** if you want DevOps Guru to analyze all resources that contain the tags you choose\. Choose a *key*, then choose one of the following options\. 
     + **All resources with this tag key** – All resources with tags that have this *key* are analyzed and grouped into an application, regardless of the tag's *value*\.
     + **Choose specific tag values** – All resources that contain a tag with the *key* you chose and one of the *values* you select are analyzed\. DevOps Guru groups your resources into applications by your tag's *values*\.

     The tag's *key* must begin with the prefix `devops-guru-`\. This prefix isn't case\-sensitive\. For example, a valid *key* is `DevOps-Guru-Production-Applications`\. For more information, see [Use tags to identify resources in your DevOps Guru applications](working-with-resource-tags.md)\.
   +  Choose **None** if you do not want DevOps Guru to analyze any resources\. This option disables DevOps Guru so that you stop incurring charges from resource analyzation\.

1. Choose **Save**\. 

## Update your notifications in DevOps Guru<a name="update-notifications"></a>

Set up Amazon Simple Notification Service topics that are used to notify you about important Amazon DevOps Guru events\. You can choose from a list of topic names that already exist in your AWS account, enter the name for a new topic that DevOps Guru creates in your account, or enter the Amazon Resource Name \(ARN\) of an existing topic in any AWS account in your Region\. If you specify the ARN of a topic that is not in your account, you must grant permission for DevOps Guru to access that topic by adding an IAM policy to it\. For more information, see [Permissions for cross account Amazon SNS topics](sns-required-permissions.md)\. You can specify up to two topics\. 

 DevOps Guru sends notifications for the following events\. 
+  A new insight is created\. 
+  A new anomaly is added to an insight\. 
+  The severity of an insight is upgraded from `Low` or `Medium` to `High`\. 
+  The status of an insight changes from ongoing to resolved\. 
+  A recommendation for an insight is identified\. 

**To update your notifications**

1. Open the Amazon DevOps Guru console at [https://console\.aws\.amazon\.com/devops\-guru/](https://console.aws.amazon.com/devops-guru/)\.

1.  Choose **Settings** in the navigation pane\. 

1.  In **SNS notifications**, choose **Set up notifications** if you have not set up any notifications\. Otherwise, choose **Edit**\. 

1.  To add an Amazon SNS topic, do one of the following\. 
   +  Choose **Chose an existing SNS topic in your AWS account**\. Then, from **Choose a topic in your AWS account**, choose the topic you want to use\. 
   +  Choose **Create a new SNS topic**\. Then, in **Create a new topic**, enter the name for your new topic\. 
   +  Choose **Use an SNS topic ARN to specify an existing account**\. Then, in **Enter an ARN for a topic**, enter the topic ARN\. The ARN is the topic's Amazon Resource Name\. You can specify a topic in a different account\. If you use a topic in another account, you must add a resource policy to the topic\. For more information, see [Permissions for cross account Amazon SNS topics](sns-required-permissions.md)\. 

1.  Choose **Add SNS topic** if you want to add a second topic\. 

1.  Choose **Save**\. 

1. To remove an Amazon SNS topic, choose **Remove** next to the topic you want to remove\. 

### Permissions added to your Amazon SNS topic<a name="permissions-added-to-sns-topic-on-update"></a>

An Amazon SNS topic is a resource that contains an AWS Identity and Access Management \(IAM\) resource policy\. When you specify a topic here, DevOps Guru appends the following permissions to its resource policy\.

```
{
    "Sid": "DevOpsGuru-added-SNS-topic-permissions",
    "Effect": "Allow",
    "Principal": {
        "Service": "region-id.devops-guru.amazonaws.com"
    },
    "Action": "sns:Publish",
    "Resource": "arn:aws:sns:region-id:topic-owner-account-id:my-topic-name",
    "Condition" : {
      "StringEquals" : {
        "AWS:SourceArn": "arn:aws:devops-guru:region-id:topic-owner-account-id:channel/devops-guru-channel-id",
        "AWS:SourceAccount": "topic-owner-account-id"
    }
  }
}
```

These permissions are required for DevOps Guru to publish notifications using a topic\. If you prefer to not have these permissions on the topic, you can safely remove them and the topic will continue to work as it did before you chose it\. However, if these appended permissions are removed, DevOps Guru cannot use the topic to generate notifications\. 

## Filter your DevOps Guru notifications<a name="update-notifications-filter"></a>

You can create an Amazon Simple Notification Service \(Amazon SNS\) subscription filter policy to reduce the number of notifications you receive from Amazon DevOps Guru\.

**Topics**
+ [Example filtered Amazon SNS notification for Amazon DevOps Guru](#sample-filtered-notification)

Use a filter policy to specify the types of notifications you receive\. You can filter your Amazon SNS messages using the following keywords\.
+ `NEW_INSIGHT` — Receive a notification when a new insight is created\.
+ `CLOSED_INSIGHT` — Receive a notification when an existing insight is closed\.
+ `NEW_RECOMMENDATION` — Receive a notification when a new recommendation is created from an insight\.
+ `NEW_ASSOCIATION` — Receive a notification when a new anomaly is detected from an insight\.
+ `CLOSED_ASSOICATION` — Receive a notification when an existing anomaly is closed\.
+ `SEVERITY_UPGRADED` — Receive a notification when the severity of an insight is upgraded

For information about how to create an Amazon SNS subscription filter policy, see [Amazon SNS subscription filter policies](https://docs.aws.amazon.com/sns/latest/dg/sns-subscription-filter-policies.html) in the *Amazon Simple Notification Service Developer Guide*\. In your filter policy, you specify one of the keywords with the policy's `MessageType`\. For example, the following would appear in a filter that specifies the Amazon SNS topic only deliver notifications when a new anomaly is detected from an insight\.

```
{ 
  "MessageType":["NEW_ ASSOCIATION"] 
}
```

### Example filtered Amazon SNS notification for Amazon DevOps Guru<a name="sample-filtered-notification"></a>

The following is an example of an Amazon Simple Notification Service \(Amazon SNS\) notification from an Amazon SNS topic with a filter policy\. Its `MessageType` is set to `NEW_ASSOCIATION`, so it sends notifications only when a new anomaly is detected from an insight\.

```
{
  "Type" : "Notification",
  "MessageId" : "9ff514ee-ba4a-515a-9298-4d6887a89c59",
  "TopicArn" : "arn:aws:sns:us-east-1:123456789012:DevOpsGuru-insights-sns",
  "Timestamp" : "2021-08-05T19:27:30.731Z",
  "MessageAttributes" : { 
      "MessageType" : {
          "Type":"String",
          "Value":"NEW_ASSOCIATION"
      } 
  },
  "Message" : {
      "AccountId": "123456789012",
      "Region": "us-east-1",
      "MessageType": "NEW_ASSOCIATION",
      "InsightId": "ADyf4FvaVNDzu9MA2-IgFDkAAAAAAAAAEGpJd5sjicgauU2wmAlnWUyyI2hiO5it",
      "InsightDescription": "ThrottledRequests",
      "StartTime": 1628767500000,
      "Anomalies": [
        {
          "Id": "AG2n8ljW74BoI1CHu-m_oAgAAAF7Ohu24N4Yro69ZSdUtn_alzPH7VTpaL30JXiF",
          "StartTime": 1628767500000,
          "SourceDetails": [
            {
              "DataSource": "CW_METRICS",
              "DataIdentifiers": {
                "stat": "Sum",
                "unit": "None",
                "period": "60",
                "ResourceId": "TaskRecords",
                "namespace": "AWS/DynamoDB",
                "name": "ThrottledRequests",
                "ResourceType": "DynamoDB/Table",
                "dimensions": "{\"TableName\":\"TaskRecords\",\"Operation\":\"BatchGetItem\"}"
              }
            }
          ]
        }
      ],
      "awsInsightSource": "aws.devopsguru"
  }
}
```

## Update AWS Systems Manager integration in DevOps Guru<a name="update-systems-manager-integration"></a>

You can enable the creation of an OpsItem for each new insight in AWS Systems Manager OpsCenter\. OpsCenter is a centralized system where you can view, investigate, and review operational work items \(OpsItems\)\. The OpsItems for your insights can help you manage work that addresses the anomalous behavior that triggered the creation of each insight\. For more information, see [AWS Systems Manager OpsCenter](https://docs.aws.amazon.com/systems-manager/latest/userguide/OpsCenter.html) and [Working with OpsItem](https://docs.aws.amazon.com/systems-manager/latest/userguide/OpsCenter-working-with-OpsItems.html) in the *AWS Systems Manager User Guide*\. 

**Note**  
If you change the key or value of the tag field of an OpsItem, then DevOps Guru is not able to update that OpsItem\. For example, if you change a tag of an OpsItem from `"aws:RequestTag/DevOps-GuruInsightSsmOpsItemRelated": "true"` to something else, then DevOps Guru cannot update that OpsItem\.

**To manage your Systems Manager integration**

1. Open the Amazon DevOps Guru console at [https://console\.aws\.amazon\.com/devops\-guru/](https://console.aws.amazon.com/devops-guru/)\.

1. Choose **Settings** in the navigation pane\. 

1. In **AWS Systems Manager integration**, select **Enable DevOps Guru to create an AWS OpstItem in OpsCenter for each insight** to have an OpsItem created for each new insight\. Deselect it to stop having an OpsItem created for each new insight\.

You are charged for OpsItems created in your account\. For more information, see [AWS Systems Manager pricing](http://aws.amazon.com/systems-manager/pricing/)\. 